# 02.02 球隊管理 (Team Management)

## 1. 概述

本文件詳細描述 VolleyBro 系統的球隊管理功能需求，涵蓋創建球隊、編輯球隊資訊、成員管理、權限角色設定、配置比賽陣容等功能。這些功能旨在為球隊管理者提供一個高效、靈活的球隊管理平台，確保球隊運作的順暢與數據的準確性。

---

## 2. 功能需求列表

### 2.0.0 創建球隊

#### FR-2.0.0.0 創建球隊

- **功能 ID**: FR-2.0.0.0
- **標題**: 創建球隊
- **描述**: 已登入用戶可創建新球隊並自動成為擁有者。
- **詳細說明**:

  - 創建表單要求輸入球隊名稱和簡稱。
  - 系統驗證球隊名稱的唯一性。
  - 創建成功後，系統自動建立創建者的隊員 (MEMBER) 資訊。
  - 系統自動將創建者設為球隊擁有者（OWNER）並連結創建者的使用者 (USER) 資訊。
  - 創建後導向球隊資訊頁面。

- **流程圖**:

  ```mermaid
  graph TD
    A[使用者進入創建球隊頁面] --> B[輸入球隊名稱和簡稱]
    B --> C{驗證資料}
    C -->|有效| D[創建球隊]
    C -->|無效| E[顯示錯誤訊息]
    D --> F[建立創建者的隊員資訊]
    F --> G[設創建者為擁有者並連結使用者資訊]
    G --> H[導向球隊資訊頁面]
  ```

- **驗收標準**:

  - 創建表單能正確驗證輸入資料，包括球隊名稱的唯一性。
  - 創建後系統自動建立創建者的隊員資訊。
  - 創建者自動被設為擁有者 (OWNER) 並連結其使用者資訊。
  - 成功後導向球隊資訊頁面。

- **測試案例**:

  ```gherkin
  Feature: 創建球隊
    Scenario: 使用者創建新球隊
      Given 使用者已登入
      When 使用者進入創建球隊頁面
      And 使用者輸入球隊名稱 "Team A" 和簡稱 "TA"
      And 使用者提交創建表單
      Then 系統驗證球隊名稱的唯一性
      And 系統創建球隊
      And 系統自動建立創建者的隊員資訊
      And 系統設創建者為擁有者並連結其使用者資訊
      And 使用者被導向球隊資訊頁面
  ```

- **Version Changes**:
  - **v0.1.0**: 首次加入 `創建球隊` 功能。

---

### 2.0.1 編輯球隊資訊

#### FR-2.0.1.0 編輯球隊名稱和簡稱

- **功能 ID**: FR-2.0.1.0
- **標題**: 編輯球隊名稱和簡稱
- **描述**: 球隊管理者可編輯球隊名稱和簡稱。
- **詳細說明**:

  - 編輯頁面顯示當前球隊名稱和簡稱。
  - 使用者可修改並提交變更。
  - 更新成功後通知所有成員。

- **流程圖**:

  ```mermaid
  graph TD
    A[管理者進入編輯球隊頁面] --> B[修改球隊名稱和簡稱]
    B --> C{驗證資料}
    C -->|有效| D[更新球隊資訊]
    C -->|無效| E[顯示錯誤訊息]
    D --> F[通知所有成員]
  ```

- **驗收標準**:

  - 編輯頁面正確顯示當前資料。
  - 更新後通知成員並顯示成功訊息。

- **測試案例**:

  ```gherkin
  Feature: 編輯球隊資訊
    Scenario: 管理者編輯球隊名稱和簡稱
      Given 管理者已登入並在球隊資訊頁面
      When 管理者進入編輯頁面
      And 管理者修改球隊名稱為 "Team B"
      And 管理者提交變更
      Then 系統更新球隊資訊並通知成員
  ```

- **Version Changes**:
  - **v0.1.0**: 首次加入 `編輯球隊資訊` 功能。

---

### 2.1.0 成員管理

#### FR-2.1.0.0 新增成員

- **功能 ID**: FR-2.1.0.0
- **標題**: 新增成員
- **描述**: 管理者可新增成員並填寫基本資料。
- **詳細說明**:

  - 成員表單包含姓名、背號和角色。
  - 系統驗證背號的唯一性。
  - 新增後發送邀請郵件至成員。

- **流程圖**:

  ```mermaid
  graph TD
    A[管理者進入成員管理頁面] --> B[填寫成員資料]
    B --> C{驗證資料}
    C -->|有效| D[新增成員]
    C -->|無效| E[顯示錯誤訊息]
    D --> F[發送邀請郵件]
  ```

- **驗收標準**:

  - 成員表單能正確驗證輸入資料。
  - 新增後發送邀請郵件。

- **測試案例**:

  ```gherkin
  Feature: 新增成員
    Scenario: 管理者新增成員
      Given 管理者已登入並在成員管理頁面
      When 管理者填寫成員姓名 "John Doe"，背號 "10"，角色 "MEMBER"
      And 管理者提交表單
      Then 系統新增成員並發送邀請郵件
  ```

- **Version Changes**:
  - **v0.1.0**: 首次加入 `新增成員` 功能。

---

### 2.1.1 權限角色設定

#### FR-2.1.1.0 設定成員角色

- **功能 ID**: FR-2.1.1.0
- **標題**: 設定成員角色
- **描述**: 管理者可設定成員的權限角色。
- **詳細說明**:

  - 權限頁面顯示成員列表及其當前角色。
  - 管理者可選擇並更改成員角色（OWNER、ADMIN、MEMBER）。
  - 更改後通知成員。

- **流程圖**:

  ```mermaid
  graph TD
    A[管理者進入權限頁面] --> B[選擇成員並更改角色]
    B --> C[提交變更]
    C --> D[更新成員角色]
    D --> E[通知成員]
  ```

- **驗收標準**:

  - 權限頁面正確顯示成員列表。
  - 角色更改後通知成員。

- **測試案例**:

  ```gherkin
  Feature: 設定成員角色
    Scenario: 管理者更改成員角色
      Given 管理者已登入並在權限頁面
      When 管理者選擇成員 "John Doe" 並更改角色為 "ADMIN"
      And 管理者提交變更
      Then 系統更新成員角色並通知成員
  ```

- **Version Changes**:
  - **v0.1.0**: 首次加入 `設定成員角色` 功能。

---

### 2.2.0 配置比賽陣容

#### FR-2.2.0.0 配置陣容

- **功能 ID**: FR-2.2.0.0
- **標題**: 配置陣容
- **描述**: 管理者可配置球隊的比賽陣容。
- **詳細說明**:

  - 可以點選陣容列表切換陣容。
  - 陣容頁面顯示球員列表和場上位置圖。
  - 陣容頁面允許拖放球員至先發、自由球員和替補。
  - 點選先發球員可以設定其場上位置。
  - 系統驗證陣容的完整性（例如，先發人數、自由球員更換位置）。
  - 配置完成後儲存陣容。

- **流程圖**:

  ```mermaid
  graph TD
    A[管理者進入陣容頁面] --> B[點選陣容列表切換不同陣容]
    B --> J[系統顯示場上位置圖和球員列表]
    J --> C[拖放球員至先發、自由和替補]
    C --> D[點選先發球員設定場上位置]
    D --> E{驗證陣容完整性}
    E -->|有效| F[儲存陣容]
    E -->|無效| G[顯示錯誤訊息]
    F --> H[陣容列表更新]
  ```

- **驗收標準**:

  - 陣容頁面正確顯示球員列表和場上位置圖。
  - 球員可以成功拖放至先發、自由球員和替補位置。
  - 點選先發球員能設定其場上位置。
  - 系統能夠驗證陣容完整性並顯示適當的錯誤訊息。
  - 陣容能成功儲存並顯示在陣容列表中。
  - 使用者可以在陣容列表中切換不同陣容。

- **測試案例**:

  ```gherkin
  Feature: 配置陣容
    Scenario: 管理者配置比賽陣容
      Given 管理者已登入並進入陣容頁面
      When 管理者查看球員列表和場上位置圖
      And 管理者將球員"王小明"拖放至先發位置
      And 管理者將球員"李大華"設為自由球員
      And 管理者點選先發球員"王小明"
      And 管理者設定"王小明"為前排攻擊手位置
      And 管理者提交陣容
      Then 系統驗證陣容完整性
      And 系統儲存陣容並顯示成功訊息

    Scenario: 管理者切換已存陣容
      Given 管理者已登入並進入陣容頁面
      When 管理者點選陣容列表中的"陣容A"
      Then 系統載入並顯示"陣容A"的配置
  ```

- **Version Changes**:
  - **v0.1.0**: 首次加入 `配置陣容` 功能。

---

## 3. 資料模型關聯

球隊管理模組涉及以下資料模型：

- **Team**: 儲存球隊基本資訊（名稱、簡稱、成員邀請對象與權限、陣容等）。
- **Member**: 儲存球隊成員資訊（姓名、背號、比賽數據等）。
- **Lineup**: 儲存球隊的比賽陣容（先發、自由球員、替補、工作人員等）。

### 球隊權限模型

| 功能         | GUEST | USER | MEMBER | ADMIN | OWNER |
| ------------ | ----- | ---- | ------ | ----- | ----- |
| 查看球隊資訊 | ❌    | -    | ✅     | ✅    | ✅    |
| 查看比賽記錄 | ❌    | -    | ✅     | ✅    | ✅    |
| 創建比賽記錄 | ❌    | ❌   | ❌     | ✅    | ✅    |
| 記錄比賽數據 | ❌    | ❌   | ✅     | ✅    | ✅    |
| 編輯球隊資訊 | ❌    | ❌   | ❌     | ✅    | ✅    |
| 管理成員資料 | ❌    | ❌   | ❌     | ✅    | ✅    |
| 邀請新成員   | ❌    | ❌   | ❌     | ✅    | ✅    |
| 設定成員權限 | ❌    | ❌   | ❌     | ✅    | ✅    |
| 創建球隊     | ❌    | ✅   | ✅     | ✅    | ✅    |
| 刪除球隊     | ❌    | ❌   | ❌     | ❌    | ✅    |

- 圖例: ✅: 可執行, ❌: 不可執行, -: 可調整

---

## 4. 技術需求

- **身份驗證**: 使用 Auth.js 實現角色權限控制。
- **資料安全**:
  - 成員資料加密儲存。
  - 敏感操作需二次驗證。
- **效能**:
  - 球隊資訊載入時間不超過 500ms。
  - 成員管理操作完成時間不超過 2 秒。
